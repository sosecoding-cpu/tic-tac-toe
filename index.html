<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tic Tac Toe – Deluxe</title>
  <style>
    :root{
      --bg1:#0f1021;
      --bg2:#1b1c33;
      --card: rgba(255,255,255,0.08);
      --stroke: rgba(255,255,255,0.15);
      --glow:#7c3aed;
      --accent:#22d3ee;
      --text:#e7e7f7;
      --muted:#b9b9d6;
      --win:#10b981;
      --x:#ff6b6b;
      --o:#60a5fa;
      --shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.25), transparent 60%),
        radial-gradient(1000px 600px at 110% 110%, rgba(34,211,238,.18), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      display:flex; align-items:center; justify-content:center; padding:24px;
    }

    .app{
      width:min(920px, 96vw);
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:24px;
      backdrop-filter: blur(12px) saturate(130%);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .header{
      display:flex; align-items:center; justify-content:space-between;
      padding:20px 24px;
      border-bottom:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      font-weight:800; letter-spacing:.4px;
    }
    .brand .logo{
      width:36px; height:36px; border-radius:12px;
      background:
        radial-gradient(12px 12px at 70% 30%, #fff6, transparent 60%),
        conic-gradient(from 200deg, var(--glow), var(--accent), var(--glow));
      box-shadow: 0 0 24px rgba(124,58,237,.5), inset 0 1px 2px rgba(255,255,255,.35);
    }

    .controls{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-end;
    }
    .select, .btn{
      appearance:none; border:none; outline:none;
      color:var(--text);
      background:rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      padding:10px 12px; border-radius:12px;
      font-weight:600;
      transition:.2s ease;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    .select{padding-right:36px; position:relative}
    .select:focus, .btn:focus{box-shadow:0 0 0 3px rgba(124,58,237,.35)}
    .btn{
      cursor:pointer;
      background:linear-gradient(180deg, rgba(124,58,237,.25), rgba(124,58,237,.12));
      border-color: rgba(124,58,237,.35);
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}

    .panel{
      display:grid; grid-template-columns: 1.2fr .8fr;
      gap:16px; padding:20px; align-items:start;
    }
    @media (max-width:880px){
      .panel{grid-template-columns:1fr}
    }

    /* Board */
    .board-wrap{
      background:rgba(255,255,255,.04);
      border:1px solid var(--stroke);
      border-radius:20px; padding:18px;
    }
    .statusbar{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:8px 12px; margin-bottom:14px;
      background:rgba(255,255,255,.04);
      border:1px dashed var(--stroke);
      border-radius:12px; font-weight:700;
    }
    .pill{
      padding:6px 10px; border-radius:999px; border:1px solid var(--stroke);
      background:rgba(255,255,255,.06); font-size:13px; font-weight:800; letter-spacing:.3px;
    }

    .board{
      --size:108px;
      display:grid; grid-template-columns:repeat(3,var(--size)); grid-template-rows:repeat(3,var(--size));
      gap:10px; justify-content:center; margin:10px auto 4px;
    }
    @media (max-width:480px){ .board{ --size:88px } }

    .cell{
      display:flex; align-items:center; justify-content:center;
      font-size:42px; font-weight:900;
      border-radius:16px; cursor:pointer;
      user-select:none;
      color:var(--text);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      transition: transform .12s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
    }
    .cell:hover{ transform:translateY(-2px); box-shadow:0 14px 28px rgba(0,0,0,.35)}
    .cell.taken{ cursor:not-allowed; opacity:.92}
    .cell.x{ text-shadow: 0 0 18px rgba(255,107,107,.45); color:var(--x)}
    .cell.o{ text-shadow: 0 0 18px rgba(96,165,250,.45); color:var(--o)}
    .cell.win{
      outline:2px solid var(--win);
      box-shadow:0 0 0 6px rgba(16,185,129,.18), 0 18px 36px rgba(0,0,0,.4);
      background:linear-gradient(180deg, rgba(16,185,129,.18), rgba(16,185,129,.05));
    }

    /* Sidebar */
    .side{
      display:flex; flex-direction:column; gap:14px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--stroke);
      border-radius:20px; padding:18px;
    }
    .score{
      display:grid; grid-template-columns:repeat(3, 1fr); gap:10px;
    }
    .card{
      padding:12px; border-radius:14px; text-align:center;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid var(--stroke);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    }
    .card h3{margin:0 0 6px 0; font-size:13px; color:var(--muted); letter-spacing:.4px}
    .big{font-size:28px; font-weight:900}

    .small{
      color:var(--muted); font-size:12px; margin-top:6px;
    }

    .footer{
      padding:14px 20px; border-top:1px solid var(--stroke);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      background:linear-gradient(0deg, rgba(255,255,255,.04), rgba(255,255,255,0));
    }
    .link{
      font-size:12px; color:var(--muted);
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>Tic Tac Toe Deluxe</div>
      </div>
      <div class="controls">
        <select id="mode" class="select" title="Mode">
          <option value="pvc">Player vs Computer</option>
          <option value="pvp">Player vs Player</option>
        </select>

        <select id="difficulty" class="select" title="Difficulty">
          <option value="easy">Easy</option>
          <option value="medium">Medium</option>
          <option value="hard">Hard</option>
        </select>

        <button id="restart" class="btn">Restart</button>
      </div>
    </div>

    <div class="panel">
      <div class="board-wrap">
        <div class="statusbar">
          <div id="turn" class="pill">Player X's turn</div>
          <div id="modeLabel" class="pill">Mode: PvC</div>
        </div>
        <div id="board" class="board" aria-label="Tic Tac Toe Board"></div>
      </div>

      <aside class="side">
        <div class="card">
          <h3>SCOREBOARD</h3>
          <div class="score">
            <div class="card"><h3>Player X</h3><div id="sx" class="big">0</div></div>
            <div class="card"><h3>Draw</h3><div id="sd" class="big">0</div></div>
            <div class="card"><h3 id="rightLabel">Computer</h3><div id="so" class="big">0</div></div>
          </div>
          <div class="small">Tip: Long-press / hold on a cell won’t place a move — single taps only.</div>
        </div>

        <div class="card">
          <h3>SETTINGS</h3>
          <div class="small">Mode switch hides difficulty in PvP. Hard uses perfect AI.</div>
        </div>
      </aside>
    </div>

    <div class="footer">
      <span class="link">Built with ❤️ — smooth glow UI, glass cards, win highlights</span>
      <button id="newMatch" class="btn" title="Play again with same settings">New Match</button>
    </div>
  </div>

  <script>
    // ---------- State ----------
    let board = Array(9).fill("");
    let currentPlayer = "X";
    let gameOver = false;
    let mode = "pvc";
    let difficulty = "easy";
    let playerTurnLock = true; // prevents extra taps during computer move
    const score = { X:0, O:0, D:0 };

    const boardEl = document.getElementById("board");
    const turnEl = document.getElementById("turn");
    const modeSel = document.getElementById("mode");
    const diffSel = document.getElementById("difficulty");
    const modeLabel = document.getElementById("modeLabel");
    const sx = document.getElementById("sx");
    const so = document.getElementById("so");
    const sd = document.getElementById("sd");
    const rightLabel = document.getElementById("rightLabel");

    // ---------- Init ----------
    setupUI();
    newMatch();

    function setupUI(){
      modeSel.addEventListener("change", () => {
        mode = modeSel.value;
        document.getElementById("difficulty").style.display = (mode === "pvc") ? "inline-block" : "none";
        rightLabel.textContent = (mode === "pvp") ? "Player O" : "Computer";
        modeLabel.textContent = "Mode: " + (mode === "pvp" ? "PvP" : "PvC");
        newMatch();
      });

      diffSel.addEventListener("change", () => {
        difficulty = diffSel.value;
        newMatch();
      });

      document.getElementById("restart").addEventListener("click", () => {
        score.X = score.O = score.D = 0;
        updateScore();
        newMatch();
      });

      document.getElementById("newMatch").addEventListener("click", newMatch);
    }

    function updateScore(){
      sx.textContent = score.X;
      so.textContent = score.O;
      sd.textContent = score.D;
    }

    function newMatch(){
      board = Array(9).fill("");
      gameOver = false;
      currentPlayer = "X";
      playerTurnLock = true;
      difficulty = diffSel.value;
      renderBoard();
      setTurnText();
    }

    // ---------- Rendering ----------
    function renderBoard(){
      boardEl.innerHTML = "";
      for (let i=0;i<9;i++){
        const cell = document.createElement("button");
        cell.className = "cell";
        cell.setAttribute("aria-label", "Cell " + (i+1));
        cell.dataset.index = i;
        cell.textContent = board[i];
        if(board[i]){
          cell.classList.add("taken");
          cell.classList.add(board[i].toLowerCase());
        }
        cell.addEventListener("click", onCellClick, { once:false });
        boardEl.appendChild(cell);
      }
    }

    function setTurnText(msg){
      if (msg){ turnEl.textContent = msg; return; }
      if (gameOver) return;
      if (mode==="pvp"){
        turnEl.textContent = `Player ${currentPlayer}'s turn`;
      } else {
        turnEl.textContent = (currentPlayer==="X") ? "Player X's turn" : "Computer's turn";
      }
    }

    // ---------- Gameplay ----------
    function onCellClick(e){
      const idx = Number(e.currentTarget.dataset.index);
      if (gameOver) return;

      // Prevent multiple taps while computer "thinking"
      if (mode==="pvc" && currentPlayer==="O") return;
      if (board[idx] !== "") return;

      placeMark(idx, currentPlayer);

      const res = evaluateGame(board);
      if (res.done){
        finish(res);
        return;
      }

      if (mode==="pvp"){
        currentPlayer = (currentPlayer === "X") ? "O" : "X";
        setTurnText();
      } else {
        // Player vs Computer
        currentPlayer = "O";
        setTurnText();
        playerTurnLock = false;
        // Instant move (your previous preference). If you ever want delay, wrap with setTimeout.
        makeComputerMove();
      }
    }

    function placeMark(index, player){
      board[index] = player;
      const cell = boardEl.querySelector(`[data-index="${index}"]`);
      if (cell){
        cell.textContent = player;
        cell.classList.add("taken", player.toLowerCase());
      }
    }

    function makeComputerMove(){
      if (gameOver || mode!=="pvc") return;

      let move;
      if (difficulty === "easy"){
        // random
        move = randomMove(board);
      } else if (difficulty === "medium"){
        // win or block; if multiple choices, randomize among best
        move = winOrBlockOrRandom(board, "O") ?? winOrBlockOrRandom(board, "X") ?? randomMove(board);
      } else {
        // perfect AI
        move = minimax(board.slice(), "O").index;
      }

      if (move !== undefined){
        placeMark(move, "O");
      }

      const res = evaluateGame(board);
      if (res.done){
        finish(res);
        return;
      }

      currentPlayer = "X";
      playerTurnLock = true;
      setTurnText();
    }

    // ---------- Helpers ----------
    const wins = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    function evaluateGame(b){
      for (const line of wins){
        const [a,b1,c] = line;
        if (b[a] && b[a]===b[b1] && b[a]===b[c]){
          highlightWin(line);
          return { done:true, winner:b[a], line };
        }
      }
      if (!b.includes("")) return { done:true, winner:"D" };
      return { done:false };
    }

    function highlightWin(line){
      for (const i of line){
        const cell = boardEl.querySelector(`[data-index="${i}"]`);
        if (cell) cell.classList.add("win");
      }
    }

    function finish(res){
      gameOver = true;
      if (res.winner === "D"){
        score.D++; updateScore();
        setTurnText("It's a Draw!");
      } else {
        if (res.winner === "X") score.X++; else score.O++;
        updateScore();
        const name = (mode==="pvp")
          ? (res.winner==="X" ? "Player X" : "Player O")
          : (res.winner==="X" ? "Player X" : "Computer");
        setTurnText(`${name} Wins!`);
      }
    }

    function emptyIndices(b){ return b.map((v,i)=>v===""?i:null).filter(v=>v!==null); }

    function randomMove(b){
      const empty = emptyIndices(b);
      return empty[Math.floor(Math.random()*empty.length)];
    }

    function winOrBlockOrRandom(b, player){
      // return a winning move for 'player' if exists; else null
      const empties = emptyIndices(b);
      const best = [];
      for (const i of empties){
        b[i] = player;
        const won = isWin(b, player);
        b[i] = "";
        if (won) best.push(i);
      }
      if (best.length) return best[Math.floor(Math.random()*best.length)];
      return null;
    }

    function isWin(b, p){
      return wins.some(line => line.every(i => b[i]===p));
    }

    // Minimax (perfect)
    function minimax(b, player){
      const hu="X", ai="O";
      const avail = emptyIndices(b);

      if (isWin(b, hu)) return { score:-10 };
      if (isWin(b, ai)) return { score: 10 };
      if (avail.length===0) return { score:0 };

      const moves = [];
      for (const i of avail){
        const move = { index:i };
        b[i] = player;
        const next = (player===ai) ? minimax(b, hu) : minimax(b, ai);
        move.score = next.score;
        b[i] = "";
        moves.push(move);
      }

      let bestMove = 0;
      if (player===ai){
        let bestScore = -Infinity;
        for (let i=0;i<moves.length;i++){
          if (moves[i].score > bestScore){ bestScore = moves[i].score; bestMove = i; }
        }
      } else {
        let bestScore = Infinity;
        for (let i=0;i<moves.length;i++){
          if (moves[i].score < bestScore){ bestScore = moves[i].score; bestMove = i; }
        }
      }
      return moves[bestMove];
    }
  </script>
</body>
  </html>
